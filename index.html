<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미소연 MMS v3.7 - 복사 붙여넣기 모드</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;900&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); background-color: #cbd5e1; gap: 1px; border-radius: 12px; overflow: hidden; }
        .calendar-day { min-height: 110px; background: white; padding: 8px; cursor: pointer; }
        .calendar-day.selected { background: #eff6ff !important; box-shadow: inset 0 0 0 2px #3b82f6; z-index: 10; }
        .menu-text { font-size: 10px; font-weight: 800; padding: 2px 4px; border-radius: 4px; margin-top: 2px; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo } = React;

        const MisoYonApp = () => {
            const [menus, setMenus] = useState([]);
            const [selectedDate, setSelectedDate] = useState(null);
            const [currentMonth, setCurrentMonth] = useState(new Date(2026, 0, 1));
            const [inputText, setInputText] = useState("");

            const handleProcessText = () => {
                const lines = inputText.split('\n');
                const formatted = lines.map(line => {
                    const parts = line.split(/,|\t/); // 쉼표나 탭으로 분리
                    if (parts.length < 4) return null;

                    const d = parts[0].match(/\d+/g);
                    if (!d || d.length < 3) return null;
                    const cleanDate = `${d[0]}-${String(d[1]).padStart(2, '0')}-${String(d[2]).padStart(2, '0')}`;

                    return {
                        date: cleanDate,
                        morning: parts[1]?.replace(/"/g, '').trim(),
                        lunch: parts[2]?.replace(/"/g, '').trim(),
                        dinner: parts[3]?.replace(/"/g, '').trim(),
                        staff: parts[5]?.replace(/"/g, '').trim() || "현황 없음"
                    };
                }).filter(Boolean);

                setMenus(formatted);
                if(formatted.length > 0) alert(formatted.length + "일치 데이터를 적용했습니다.");
            };

            const calendarDays = useMemo(() => {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const days = [];
                for (let i = 0; i < firstDay; i++) days.push(null);
                for (let i = 1; i <= daysInMonth; i++) {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    const dayData = menus.find(m => m.date === dateStr);
                    days.push({ day: i, dateStr, data: dayData });
                }
                return days;
            }, [currentMonth, menus]);

            return (
                <div className="p-4 max-w-6xl mx-auto">
                    <header className="bg-white p-6 rounded-3xl shadow-sm border mb-6">
                        <h1 className="text-xl font-black text-blue-600 mb-4">MISOYON MMS v3.7 (안정화 버전)</h1>
                        <div className="flex flex-col gap-2">
                            <textarea 
                                className="w-full p-3 border rounded-xl text-sm" 
                                rows="3" 
                                placeholder="엑셀 내용을 복사해서 여기에 붙여넣으세요 (날짜, 아침, 점심, 저녁 순서)"
                                value={inputText}
                                onChange={(e) => setInputText(e.target.value)}
                            />
                            <button onClick={handleProcessText} className="bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700">식단 적용하기</button>
                        </div>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 bg-white p-4 rounded-2xl border">
                            <div className="flex justify-between mb-4 px-2">
                                <button onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth()-1))}>◀</button>
                                <h2 className="font-bold">{currentMonth.getFullYear()}년 {currentMonth.getMonth()+1}월</h2>
                                <button onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth()+1))}>▶</button>
                            </div>
                            <div className="calendar-grid">
                                {['일','월','화','수','목','금','토'].map(d => <div key={d} className="bg-slate-50 py-2 text-center text-[10px] font-bold text-slate-400">{d}</div>)}
                                {calendarDays.map((d, i) => (
                                    <div key={i} className={`calendar-day ${d?.dateStr === selectedDate?.date ? 'selected' : ''}`} onClick={() => d?.data && setSelectedDate(d.data)}>
                                        {d && (
                                            <>
                                                <span className={`text-xs font-bold ${d.data ? 'text-blue-600' : 'text-slate-300'}`}>{d.day}</span>
                                                {d.data && (
                                                    <div>
                                                        <span className="menu-text bg-orange-50 text-orange-600">조:{d.data.morning}</span>
                                                        <span className="menu-text bg-blue-50 text-blue-600">중:{d.data.lunch}</span>
                                                    </div>
                                                )}
                                            </>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                        <div className="bg-white p-6 rounded-2xl border shadow-lg">
                            {selectedDate ? (
                                <div>
                                    <h3 className="font-black text-blue-600 mb-4">{selectedDate.date}</h3>
                                    <div className="bg-slate-900 text-white p-4 rounded-xl mb-4 text-sm">{selectedDate.staff}</div>
                                    <div className="space-y-3">
                                        <div className="p-3 bg-orange-50 rounded-lg"><p className="text-[10px] font-bold text-orange-400">아침</p><p className="font-bold">{selectedDate.morning}</p></div>
                                        <div className="p-3 bg-blue-50 rounded-lg"><p className="text-[10px] font-bold text-blue-400">점심</p><p className="font-bold">{selectedDate.lunch}</p></div>
                                        <div className="p-3 bg-purple-50 rounded-lg"><p className="text-[10px] font-bold text-purple-400">저녁</p><p className="font-bold">{selectedDate.dinner}</p></div>
                                    </div>
                                </div>
                            ) : <div className="text-center py-20 text-slate-300 font-bold">날짜를 선택하세요</div>}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MisoYonApp />);
    </script>
</body>
</html>
