/**
 * 미소연 통합 검색 시스템 v1.0
 * 셰프님의 레시피 폼과 외부 검색을 결합합니다.
 */
function getIntegratedSearch(query) {
  const recipeData = searchInternalRecipes(query); // 시트 내 레시피 검색
  const externalLinks = generateExternalLinks(query); // 유튜브/웹 검색 링크 생성
  
  return {
    internal: recipeData,
    external: externalLinks
  };
}

// 셰프님이 만드신 '레시피' 시트의 폼 구조를 추적하는 함수
function searchInternalRecipes(query) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getSheetByName("레시피");
  const data = sheet.getDataRange().getValues();
  let results = [];

  for (let i = 0; i < data.length; i++) {
    // C열(메뉴명)에서 검색어 확인
    if (data[i][2] && String(data[i][2]).includes(query)) {
      results.push({
        name: data[i][2],
        code: data[i+1][2], // 관리코드
        mainIngred: data[i+6][2], // 주재료
        rowIndex: i + 1
      });
    }
  }
  return results;
}

// 유튜브 및 웹 검색 쿼리 생성 (기능 유지)
function generateExternalLinks(query) {
  return {
    youtube: "https://www.youtube.com/results?search_query=" + encodeURIComponent(query + " 레시피"),
    web: "https://www.google.com/search?q=" + encodeURIComponent(query + " 전문 레시피")
  };
}
