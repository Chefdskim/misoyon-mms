<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MISOYON MMS v12.6 - Mobile Optimized</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        body, html { width: 100%; height: 100%; background: #f8fafc; overflow-x: hidden; }
        #root { width: 100%; min-height: 100vh; display: flex; flex-direction: column; }
        
        /* Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ Î∞òÏùëÌòï: PCÎäî Í∞ÄÎ°ú, Î™®Î∞îÏùºÏùÄ ÏÑ∏Î°ú */
        .main-container { display: flex; flex: 1; flex-direction: column; overflow: hidden; }
        @media (min-width: 1024px) { .main-container { flex-direction: row; } }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); grid-template-rows: 25px repeat(6, 1fr); background: #cbd5e1; gap: 1px; border: 1px solid #cbd5e1; width: 100%; }
        .calendar-day { background: white; padding: 4px; cursor: pointer; display: flex; flex-direction: column; min-height: 70px; }
        .calendar-day.selected { background: #eff6ff !important; box-shadow: inset 0 0 0 2px #3b82f6; z-index: 10; }
        .menu-text { font-size: 8px; font-weight: 800; line-height: 1.1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 1px; padding: 1px 2px; border-radius: 2px; }
        
        .modal-view { position: fixed; inset: 0; background: white; z-index: 200; display: flex; flex-direction: column; }
        .recipe-popup { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 300; display: flex; align-items: center; justify-content: center; padding: 15px; backdrop-filter: blur(8px); }
        .recipe-content { font-size: 13px; font-weight: 600; color: #1e293b; line-height: 1.6; white-space: pre-wrap; word-break: break-all; }
        .hl-red { color: #ef4444; text-decoration: underline; font-weight: 900; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const MisoYonApp = () => {
            const MENU_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSnsej-xGogyedNPYTs2iqEMFKAwIL3tipLoSiDDKxKHot-PITnmxYETDseGckqpb6EMiQm39Sfol0-/pub?output=csv";
            
            // ÏÖ∞ÌîÑÎãòÏù¥ Ï£ºÏã† Î†àÏãúÌîº 10Ï¢Ö ÏµúÏã† Î∞òÏòÅ (ÏûêÎèô Ïó∞Îèô Ï†Ñ Îã®Í≥Ñ)
            const RECIPE_STORE = {
                "ÏòÅÍ¥ëÍµ¥ÎπÑ": { name: "ÏòÅÍ¥ëÍµ¥ÎπÑ Íµ¨Ïù¥", ingredients: `ÏòÅÍ¥ëÍµ¥ÎπÑ, ÏåÄÎú®Î¨º, ÏÜåÍ∏à, Î∞±ÌõÑÏ∂î, ÏÉùÍ∞ïÏà†, Ï∞∏Í∏∞Î¶Ñ`, process: `1. ÏåÄÎú®Î¨ºÏóê Îã¥Í∞Ä ÎπÑÎ¶∞ÎÇ¥ Ï†úÍ±∞\n2. ÎπÑÎäò/ÏßÄÎäêÎü¨ÎØ∏ ÏÜêÏßà\n3. ÏÜåÍ∏à, Î∞±ÌõÑÏ∂î, ÏÉùÍ∞ïÏà† Î∞ëÍ∞Ñ\n4. Ï∞∏Í∏∞Î¶Ñ ÎèÑÌè¨ ÌõÑ 180ÎèÑ Ïò§Î∏ê 10Î∂Ñ, Îí§ÏßëÏñ¥ 5Î∂Ñ` },
                "Ï£ºÍæ∏ÎØ∏Ï†ÑÎ≥µ": { name: "Ï£ºÍæ∏ÎØ∏ Ï†ÑÎ≥µÎ≥∂Ïùå", ingredients: `Ï£ºÍæ∏ÎØ∏ 10ÎßàÎ¶¨, Ï†ÑÎ≥µ 5ÎßàÎ¶¨, ÎåÄÌåå, ÎãπÍ∑º, Í≥†Ï∂î, ÎßàÎäò, ÏÉùÍ∞ï, Íµ¥ÏÜåÏä§, Î≤ÑÌÑ∞`, process: `1. Ìï¥ÏÇ∞Î¨º Îç∞ÏπòÍ∏∞\n2. Ìñ•Ïã†Ï±Ñ Î≥∂Í∏∞\n3. Ï±ÑÏÜå/Ìï¥ÏÇ∞Î¨º Ìà¨ÏûÖ\n4. Íµ¥ÏÜåÏä§, Î≤ÑÌÑ∞Î°ú ÎßàÎ¨¥Î¶¨` },
                "Îã§Ïä¨Í∏∞": { name: "ÏïàÎèô Í≥®Î∂ÄÎ¶¨Íµ≠", ingredients: `Îã§Ïä¨Í∏∞ 500g, ÏñºÍ∞àÏù¥ 100g, Î∂ÄÏ∂î 50g, Î∞ÄÍ∞ÄÎ£® 10g, ÎêúÏû• 15g, Ìô©ÌÉúÏú°Ïàò 3L`, process: `1. Îã§Ïä¨Í∏∞ Ìï¥Í∞ê Î∞è ÏÇ∂Í∏∞\n2. ÎÇòÎ¨ºÍ≥º ÏñëÎÖê Î≤ÑÎ¨¥Î¶¨Í∏∞\n3. Ïú°ÏàòÏóê ÎÇòÎ¨ºÍ≥º Îã§Ïä¨Í∏∞ ÎÑ£Í≥† ÎÅìÏù¥Í∏∞\n4. Î∂ÄÏ∂îÎ°ú ÎßàÎ¨¥Î¶¨` },
                "Î≥µÏñ¥Îß§Ïö¥ÌÉï": { name: "Î≥µÏñ¥ Îß§Ïö¥ÌÉï", ingredients: `Î≥µÏñ¥ 2kg, ÏΩ©ÎÇòÎ¨º 180g, ÎØ∏ÎÇòÎ¶¨ 100g, Í∞ÄÏì∞Ïò§Î∂ÄÏãú Ïú°Ïàò 2L, ÎπÑÎ≤ï Îã§Îç∞Í∏∞`, process: `1. Î≥µÏñ¥ ÏÜêÏßà Î∞è ÌïèÎ¨º Ï†úÍ±∞(3ÏãúÍ∞Ñ)\n2. Ïú°ÏàòÏóê Îã§Îç∞Í∏∞ ÌíÄÍ≥† ÎÅìÏù¥Í∏∞\n3. ÏΩ©ÎÇòÎ¨º, Î≥µÏñ¥ Ìà¨ÏûÖ\n4. ÎØ∏ÎÇòÎ¶¨ ÎßàÎ¨¥Î¶¨` },
                "Î∂ÅÏñ¥Íµ≠": { name: "Ï†ïÌÜµ Î∂ÅÏñ¥Íµ≠", ingredients: `Î∂ÅÏñ¥ 50g, Î¨¥ 100g, Í≥ÑÎûÄ 1Ïïå, ÎëêÎ∂Ä, Ï∞∏Í∏∞Î¶Ñ, Îã§ÏßÑ ÎßàÎäò`, process: `1. Î∂ÅÏñ¥ Î∂àÎ¶¨Í∏∞\n2. Ï∞∏Í∏∞Î¶ÑÏóê Î∂ÅÏñ¥, ÎßàÎäò, Î¨¥ Î≥∂Í∏∞\n3. Ïú°Ïàò Î∂ÄÏñ¥Í∞ÄÎ©∞ ÎΩÄÏñóÍ≤å Ïö∞Î†§ÎÇ¥Í∏∞\n4. Í≥ÑÎûÄÎ¨º ÌíÄÍ∏∞` },
                "Ïú°Í∞úÏû•": { name: "Ï†ÑÌÜµ Ïú°Í∞úÏû•", ingredients: `ÌïúÏö∞ÏñëÏßÄ 300g, Í≥†ÏÇ¨Î¶¨, ÏàôÏ£º, ÌÜ†ÎûÄ, Í≥†Ï∂îÍ∏∞Î¶Ñ, ÎåÄÌåå`, process: `1. ÏñëÏßÄ ÏÇ∂ÏïÑ Ï∞¢Í∏∞\n2. Í≥†Í∏∞ ÏñëÎÖêÌïòÍ∏∞\n3. Ïú°ÏàòÏóê ÎÇòÎ¨º/Í≥†Í∏∞ ÎÑ£Í≥† Ìëπ ÎÅìÏù¥Í∏∞\n4. Í≥†Ï∂îÍ∏∞Î¶Ñ, ÏàôÏ£ºÎ°ú ÎßàÎ¨¥Î¶¨` },
                "Ïò§ÏßïÏñ¥Î¨¥Íµ≠": { name: "ÏãúÏõê Ïò§ÏßïÏñ¥Î¨¥Íµ≠", ingredients: `Ïò§ÏßïÏñ¥ 1kg, Î¨¥ 100g, ÏÉàÏö∞Ï†ì, Í≥†Ï∂ßÍ∞ÄÎ£®, Î©∏ÏπòÏú°Ïàò 2L`, process: `1. Ïò§ÏßïÏñ¥/Î¨¥ ÏÜêÏßà\n2. Ïú°ÏàòÏóê Î¨¥ ÎÅìÏù¥Îã§ Í≥†Ï∂ßÍ∞ÄÎ£® ÌíÄÍ∏∞\n3. ÏÉàÏö∞Ï†ì Í∞Ñ ÌïòÍ≥† Ïò§ÏßïÏñ¥ Ìà¨ÏûÖ\n4. ÎåÄÌåå ÎßàÎ¨¥Î¶¨` },
                "ÏÑ†ÏßÄÌï¥Ïû•Íµ≠": { name: "Ïû•ÌÑ∞ ÏÑ†ÏßÄÌï¥Ïû•Íµ≠", ingredients: `ÏÑ†ÏßÄ 1kg, Ïö∞Í±∞ÏßÄ 100g, ÏΩ©ÎÇòÎ¨º, ÎêúÏû•, Í≥†Ï∂îÏû•`, process: `1. ÏÑ†ÏßÄ Îç∞ÏπòÍ∏∞\n2. Ïö∞Í±∞ÏßÄ/ÏΩ©ÎÇòÎ¨º ÏñëÎÖê Î¨¥Ïπ®\n3. ÎêúÏû• Ïú°ÏàòÏóê ÎÇòÎ¨º ÎÅìÏù¥Í∏∞\n4. ÏÑ†ÏßÄ Ìà¨ÏûÖ ÌõÑ ÎßàÎ¨¥Î¶¨` },
                "ÏãúÎûòÍ∏∞": { name: "ÏãúÎûòÍ∏∞ ÎêúÏû•Íµ≠", ingredients: `Î¨¥Ï≤≠ÏãúÎûòÍ∏∞ 100g, ÎêúÏû• 60g, Ïú°Ïàò 8Ïªµ, ÎåÄÌåå, ÎßàÎäò`, process: `1. ÏãúÎûòÍ∏∞ Î∂àÎ†§ ÍªçÏßà Ï†úÍ±∞\n2. ÎêúÏû• Î≤ÑÎ¨¥Î¶¨Í∏∞\n3. Ïú°ÏàòÏóê ÎÑ£Í≥† ÏïΩÎ∂àÏóê Ìëπ Í≥†Í∏∞\n4. ÎåÄÌåå/ÎßàÎäò Í∞Ñ ÌïòÍ∏∞` },
                "ÏÜåÍ≥†Í∏∞Î¨¥Íµ≠": { name: "ÏÜåÍ≥†Í∏∞ Î¨¥Íµ≠", ingredients: `ÏñëÏßÄ 200g, Î¨¥ 200g, ÎåÄÌåå, Ï∞∏Í∏∞Î¶Ñ, Íµ≠Í∞ÑÏû•`, process: `1. ÏñëÏßÄ ÏñëÎÖê\n2. Ï∞∏Í∏∞Î¶ÑÏóê Í≥†Í∏∞/Î¨¥ Î≥∂Í∏∞\n3. Ïú°Ïàò Î∂ìÍ≥† Í±∞Ìíà Ï†úÍ±∞ÌïòÎ©∞ ÎÅìÏù¥Í∏∞\n4. ÎåÄÌåå ÎßàÎ¨¥Î¶¨` }
            };

            const [menus, setMenus] = useState([]);
            const [selectedDate, setSelectedDate] = useState(null);
            const [currentMonth, setCurrentMonth] = useState(new Date(2026, 0, 1));
            const [searchTerm, setSearchTerm] = useState("");
            const [modalSearch, setModalSearch] = useState("");
            const [activeModal, setActiveModal] = useState(false);
            const [viewRecipeList, setViewRecipeList] = useState([]);

            useEffect(() => {
                Papa.parse(MENU_URL, { download: true, complete: (res) => {
                    let temp = []; let headers = [];
                    res.data.forEach(row => {
                        const label = (row[0] || "").replace(/\s/g, "");
                        const vals = row.slice(1);
                        if (label === "ÎÇ†Ïßú") {
                            headers = vals.map(v => {
                                const m = (v || "").match(/(\d{4})[^\d]*(\d{1,2})[^\d]*(\d{1,2})/);
                                return m ? `${m[1]}-${m[2].padStart(2, '0')}-${m[3].padStart(2, '0')}` : null;
                            });
                            headers.forEach(d => { if(d) temp.push({ date: d, morning: "", lunch: "", dinner: "" }); });
                        } else if (headers.length > 0) {
                            vals.forEach((v, i) => {
                                if (!headers[i]) return;
                                const t = temp.find(m => m.date === headers[i]);
                                if (t) {
                                    if (label.includes("ÏïÑÏπ®")) t.morning = v;
                                    else if (label.includes("Ï†êÏã¨")) t.lunch = v;
                                    else if (label.includes("Ï†ÄÎÖÅ")) t.dinner = v;
                                }
                            });
                        }
                    });
                    setMenus(temp);
                }});
            }, []);

            const findMatchedRecipes = (menuName) => {
                if (!menuName || menuName === "ÏùºÏ†ïÏóÜÏùå") return [];
                const target = menuName.replace(/\s/g, "");
                return Object.keys(RECIPE_STORE).filter(k => target.includes(k)).map(k => RECIPE_STORE[k]);
            };

            const currentSearchResults = useMemo(() => {
                const q = (activeModal ? modalSearch : searchTerm).trim().toLowerCase();
                if (!q) return [];
                return menus.filter(m => (m.morning + m.lunch + m.dinner).toLowerCase().includes(q)).sort((a,b) => new Date(b.date) - new Date(a.date));
            }, [modalSearch, searchTerm, activeModal, menus]);

            const highlightText = (text, query) => {
                if (!query || !text || !isNaN(query)) return text;
                const parts = text.split(new RegExp(`(${query})`, 'gi'));
                return parts.map((p, i) => p.toLowerCase() === query.toLowerCase() ? <span key={i} className="hl-red">{p}</span> : p);
            };

            const MenuCard = ({text, type, query}) => {
                const matched = findMatchedRecipes(text);
                const hasRecipe = matched.length > 0;
                return (
                    <div className={`p-4 rounded-2xl border mb-3 active:scale-[0.98] transition-all ${hasRecipe ? 'bg-blue-50 border-blue-200' : 'bg-white border-slate-100'}`}
                         onClick={() => hasRecipe && setViewRecipeList(matched)}>
                        <div className="text-[10px] font-black text-slate-400 uppercase mb-1">{type}</div>
                        <div className={`text-sm font-black ${hasRecipe ? 'text-blue-900' : 'text-slate-600'}`}>
                            {highlightText(text, query)} {hasRecipe && "üìã"}
                        </div>
                    </div>
                );
            };

            return (
                <div id="root">
                    <header className="px-4 py-3 bg-white border-b sticky top-0 z-[100] shadow-sm">
                        <div className="flex justify-between items-center mb-2">
                            <h1 className="text-xl font-black italic tracking-tighter text-slate-800">MISOYON <span className="text-blue-600">v12.6</span></h1>
                            <div className="flex gap-2">
                                <button onClick={()=>{setModalSearch(""); setActiveModal(true);}} className="bg-blue-600 text-white p-2 rounded-xl text-xs font-black">SEARCH</button>
                            </div>
                        </div>
                        <div className="flex gap-2 items-center overflow-x-auto pb-1">
                            <div className="bg-slate-100 px-3 py-1.5 rounded-xl font-black text-xs shrink-0">
                                {currentMonth.getFullYear()}ÎÖÑ {currentMonth.getMonth()+1}Ïõî
                            </div>
                            <div className="flex gap-1">
                                <button onClick={()=>setCurrentMonth(new Date(currentMonth.setMonth(currentMonth.getMonth()-1)))} className="bg-slate-200 w-8 h-8 rounded-lg text-lg">‚Äπ</button>
                                <button onClick={()=>setCurrentMonth(new Date(currentMonth.setMonth(currentMonth.getMonth()+1)))} className="bg-slate-200 w-8 h-8 rounded-lg text-lg">‚Ä∫</button>
                            </div>
                        </div>
                    </header>

                    <div className="main-container">
                        <div className="flex-[2] bg-slate-200">
                            <div className="calendar-grid">
                                {['Ïùº','Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†'].map(d=><div key={d} className="bg-slate-50 py-1 text-center text-[10px] font-black text-slate-400">{d}</div>)}
                                {useMemo(() => {
                                    const year = currentMonth.getFullYear(), month = currentMonth.getMonth();
                                    const first = new Date(year, month, 1).getDay();
                                    const last = new Date(year, month + 1, 0).getDate();
                                    const days = [];
                                    for (let i = 0; i < first; i++) days.push(null);
                                    for (let i = 1; i <= last; i++) {
                                        const ds = `${year}-${String(month+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                                        days.push({ day: i, dateStr: ds, data: menus.find(m => m.date === ds) });
                                    }
                                    return days;
                                }, [currentMonth, menus]).map((d,i)=>(
                                    <div key={i} className={`calendar-day ${d?.dateStr === selectedDate?.date ? 'selected' : ''}`} onClick={()=>d?.data && setSelectedDate(d.data)}>
                                        {d && (
                                            <>
                                                <span className={`text-[10px] font-black ${d.data ? 'text-slate-800' : 'text-slate-200'}`}>{d.day}</span>
                                                {d.data && (
                                                    <div className="flex flex-col gap-[1px]">
                                                        {d.data.lunch && <div className="menu-text bg-blue-50 text-blue-600">Ï§ë:{d.data.lunch}</div>}
                                                        {d.data.dinner && <div className="menu-text bg-purple-50 text-purple-600">ÏÑù:{d.data.dinner}</div>}
                                                    </div>
                                                )}
                                            </>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                        <aside className="flex-1 bg-white p-5 border-t lg:border-t-0 lg:border-l overflow-y-auto">
                            {selectedDate ? (
                                <div>
                                    <div className="flex justify-between items-end border-b-4 border-blue-600 pb-2 mb-6">
                                        <h2 className="text-2xl font-black italic uppercase">Today</h2>
                                        <span className="text-slate-400 font-bold text-sm">{selectedDate.date.replace(/-/g,'.')}</span>
                                    </div>
                                    <MenuCard text={selectedDate.morning} type="Morning" />
                                    <MenuCard text={selectedDate.lunch} type="Lunch" />
                                    <MenuCard text={selectedDate.dinner} type="Dinner" />
                                </div>
                            ) : <div className="h-40 flex items-center justify-center text-slate-300 font-black italic text-sm">Îã¨Î†•ÏóêÏÑú ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.</div>}
                        </aside>
                    </div>

                    {activeModal && (
                        <div className="modal-view">
                            <div className="flex justify-between items-center p-4 border-b-2 border-blue-600">
                                <h2 className="text-xl font-black italic">SEARCH</h2>
                                <button onClick={()=>setActiveModal(false)} className="text-3xl">&times;</button>
                            </div>
                            <div className="p-4">
                                <input className="w-full bg-slate-100 px-5 py-3 rounded-2xl font-bold border-2 border-blue-600 outline-none" placeholder="Î©îÎâ¥ ÌòπÏùÄ ÎÇ†Ïßú ÏûÖÎ†•..." autoFocus value={modalSearch} onChange={e=>setModalSearch(e.target.value)}/>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-4">
                                {currentSearchResults.map((m, i) => (
                                    <div key={i} className="bg-slate-50 p-4 rounded-3xl border">
                                        <div className="font-black text-blue-600 mb-3">{m.date}</div>
                                        <MenuCard text={m.morning} type="Morning" query={modalSearch} />
                                        <MenuCard text={m.lunch} type="Lunch" query={modalSearch} />
                                        <MenuCard text={m.dinner} type="Dinner" query={modalSearch} />
                                    </div>
                                ))}
                                {currentSearchResults.length === 0 && modalSearch && <div className="text-center py-10 text-slate-300 font-black italic">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>}
                            </div>
                        </div>
                    )}

                    {viewRecipeList.length > 0 && (
                        <div className="recipe-popup" onClick={() => setViewRecipeList([])}>
                            <div className="bg-white rounded-[2rem] w-full max-w-lg p-6 max-h-[85vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-6 border-b pb-4">
                                    <h3 className="text-xl font-black italic text-blue-600">RECIPE MASTER</h3>
                                    <button onClick={() => setViewRecipeList([])} className="text-3xl">&times;</button>
                                </div>
                                {viewRecipeList.map((r, i) => (
                                    <div key={i} className="mb-8 last:mb-0">
                                        <div className="bg-blue-600 text-white px-4 py-1 rounded-full inline-block text-[10px] font-black mb-4">{r.name}</div>
                                        <div className="space-y-6">
                                            <div><div className="text-[10px] font-black text-slate-400 uppercase mb-1">Ingredients</div><div className="recipe-content bg-slate-50 p-4 rounded-2xl">{r.ingredients}</div></div>
                                            <div><div className="text-[10px] font-black text-slate-400 uppercase mb-1">Instructions</div><div className="recipe-content bg-slate-50 p-4 rounded-2xl">{r.process}</div></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MisoYonApp />);
    </script>
</body>
</html>
